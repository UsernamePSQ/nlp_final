data_point = {'IOBtags': ['O', 'O', 'B-Task', 'I-Task', 'I-Task', 'I-Task', 'O', 'O', 'O',
             'O', 'O', 'O', 'B-Task', 'I-Task', 'I-Task', 'I-Task', 'I-Task',
             'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'B-Process', 'O', 'O',
             'O', 'O', 'O', 'B-Process', 'I-Process', 'I-Process', 'I-Process',
             'I-Process', 'I-Process', 'O', 'O', 'B-Process', 'I-Process',
             'I-Process', 'O', 'O', 'O', 'B-Process', 'O', 'O', 'O', 'O', 'O',
             'B-Process', 'I-Process', 'I-Process', 'I-Process', 'I-Process',
             'I-Process', 'I-Process', 'O', 'O', 'O', 'O', 'O', 'O', 'O',
             'B-Process', 'I-Process', 'O', 'O', 'O', 'B-Material',
             'I-Material', 'I-Material', 'I-Material', 'O', 'O', 'O',
             'B-Material', 'I-Material', 'O', 'O', 'O', 'O', 'O', 'O',
             'B-Material', 'O', 'O', 'B-Process', 'I-Process', 'B-Process', 'O',
             'O', 'O', 'O', 'O', 'B-Process', 'I-Process', 'B-Process', 'O',
             'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O',
             'O', 'O', 'O', 'B-Process', 'O', 'B-Process', 'O', 'O', 'O', 'O',
             'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O',
             'O', 'O', 'B-Process', 'I-Process', 'O', 'B-Process', 'I-Process',
             'I-Process', 'I-Process', 'I-Process', 'O', 'O', 'O', 'O',
             'B-Task', 'I-Task', 'O', 'B-Material', 'I-Material', 'I-Material',
             'I-Material', 'I-Material', 'O', 'O', 'O', 'O', 'O', 'O',
             'B-Process', 'O', 'O', 'O', 'O', 'B-Process', 'I-Process', 'O',
             'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O', 'O'],
 'annotation_names': ['T15', 'T16', 'T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7',
                      'T8', 'T18', 'T9', 'T10', 'T11', 'T12', 'T19', 'T20',
                      'T21', 'T22', 'T13', 'T14', 'T23', 'T24'],
 'locations': [(0, 8), (9, 12), (13, 17), (18, 24), (25, 29), (30, 37),
               (38, 40), (41, 43), (44, 56), (57, 68), (69, 79), (79, 80),
               (81, 89), (90, 94), (95, 102), (103, 106), (107, 114),
               (115, 119), (120, 127), (128, 137), (138, 148), (148, 149),
               (150, 152), (153, 159), (159, 160), (161, 164), (165, 172),
               (173, 178), (179, 181), (182, 185), (186, 188), (189, 190),
               (191, 195), (196, 202), (203, 205), (206, 209), (210, 214),
               (215, 222), (223, 225), (226, 228), (229, 241), (242, 247),
               (248, 257), (257, 258), (259, 262), (263, 266), (267, 274),
               (275, 280), (281, 283), (284, 287), (288, 290), (291, 294),
               (295, 304), (305, 311), (312, 314), (315, 316), (317, 323),
               (324, 332), (333, 338), (338, 339), (340, 350), (351, 353),
               (354, 357), (358, 365), (365, 366), (367, 370), (371, 377),
               (378, 386), (387, 389), (390, 398), (399, 401), (402, 409),
               (409, 410), (410, 415), (416, 421), (421, 422), (423, 431),
               (432, 441), (442, 448), (449, 454), (454, 455), (456, 460),
               (461, 464), (465, 472), (473, 483), (484, 486), (487, 492),
               (493, 497), (498, 499), (500, 507), (508, 517), (518, 520),
               (521, 526), (527, 529), (530, 534), (535, 537), (538, 541),
               (542, 549), (550, 559), (560, 561), (561, 562), (563, 570),
               (571, 579), (580, 582), (583, 587), (588, 592), (593, 596),
               (597, 602), (603, 605), (606, 614), (615, 616), (617, 620),
               (621, 623), (624, 626), (627, 631), (636, 637), (638, 642),
               (643, 644), (644, 645), (645, 647), (647, 648), (649, 654),
               (655, 657), (658, 659), (660, 665), (666, 675), (676, 680),
               (680, 681), (681, 689), (690, 698), (698, 699), (700, 703),
               (704, 708), (709, 711), (712, 717), (718, 720), (721, 730),
               (731, 733), (734, 737), (738, 742), (743, 750), (751, 754),
               (755, 756), (756, 757), (757, 758), (758, 760), (760, 761),
               (761, 762), (763, 767), (767, 768), (769, 771), (772, 781),
               (782, 791), (792, 794), (795, 799), (799, 800), (800, 810),
               (811, 817), (818, 823), (823, 824), (825, 827), (828, 838),
               (839, 843), (844, 850), (851, 853), (854, 856), (857, 858),
               (858, 868), (869, 873), (874, 877), (878, 885), (886, 900),
               (900, 901), (902, 907), (908, 912), (913, 915), (916, 919),
               (919, 920), (920, 927), (928, 934), (935, 937), (938, 941),
               (942, 948), (949, 957), (957, 958)],
 'relations': [('*', 'Synonym', 'T10', 'T9'), ('*', 'Synonym', 'T12', 'T11'),
               ('R1', 'Hyponym', 'T8', 'T7'), ('R2', 'Hyponym', 'T7', 'T18'),
               ('R3', 'Hyponym', 'T8', 'T18')],
 'tokens': ['Although', 'the', 'free', 'Kelvin', 'wave', 'problem', 'is', 'of',
            'considerable', 'theoretical', 'importance', ',', 'problems',
            'with', 'forcing', 'and', 'damping', 'have', 'greater', 'practical',
            'importance', '.', 'In', 'nature', ',', 'the', 'forcing', 'could',
            'be', 'due', 'to', 'a', 'wind', 'stress', 'at', 'the', 'free',
            'surface', 'or', 'an', 'astronomical', 'tidal', 'potential', ',',
            'and', 'the', 'damping', 'could', 'be', 'due', 'to', 'the',
            'turbulent', 'stress', 'of', 'a', 'bottom', 'boundary', 'layer',
            '.', 'Regardless', 'of', 'the', 'details', ',', 'the', 'forced',
            'response', 'is', 'composed', 'of', 'shallow', '-', 'water',
            'waves', ',', 'possibly', 'including', 'Kelvin', 'waves', ',',
            'with', 'the', 'largest', 'amplitudes', 'in', 'waves', 'with', 'a',
            'natural', 'frequency', 'ωf', 'close', 'to', 'that', 'of', 'the',
            'forcing', 'frequency', 'ω', ';', 'various', 'examples', 'of',
            'this', 'sort', 'are', 'given', 'in', 'Chapters', '9', 'and', '10',
            'of', 'Gill', '.', 'When', 'ω', '≈', 'ωf', ',', 'there', 'is', 'a',
            'large', 'amplitude', 'near', '-', 'resonant', 'response', ',',
            'the', 'size', 'of', 'which', 'is', 'sensitive', 'to', 'the',
            'weak', 'damping', 'and', '|', 'ω', '−', 'ωf', '|', '.', 'Thus',
            ',', 'in', 'numerical', 'solutions', 'of', 'near', '-',
            'resonantly', 'forced', 'waves', ',', 'we', 'anticipate', 'that',
            'errors', 'in', 'ωf', '(', 'associated', 'with', 'the', 'spatial',
            'discretisation', ')', 'could', 'lead', 'to', 'non', '-', 'trivial',
            'errors', 'in', 'the', 'forced', 'response', '.']}

class List_identifyer():

    def __init__(self):
        self.entity_lists = {}
        self.tmp = []  # Used in 'find_lists

    def find_lists(self, data):

        for txt, data_point in data.items():
            self.txt = txt
            tokens = data_point['tokens']
            IOBtags = data_point['IOBtags']
            ann_names = data_point['annotation_names']

            token_idx = 0
            entity_number = 0

            #We will iterate over tokens using token_idx and search for lists.
            while True:

                #When we reach this token_idx, we will stop (later code explains)
                if token_idx >= len(tokens)-1:
                    break

                #If the current is 'B', add to tmp
                if IOBtags[token_idx][0] == 'B':
                    self._add_list_and_reset()  # Add tmp and reset
                    self.tmp = [ann_names[entity_number]]
                    entity_number += 1
                    token_idx += 1
                    continue

                # If the next is I, skip                    
                if IOBtags[token_idx][0] == 'I':
                    token_idx += 1
                    continue  # Next loop
                
                # If the next is not I:

                # Check options for adding items to list
                option_1 = tokens[token_idx] == ',' and IOBtags[token_idx+1][0] == 'B'

                option_2 = tokens[token_idx] == 'and' and IOBtags[token_idx+1][0] == 'B'
                option_3 = tokens[token_idx] == 'or' and IOBtags[token_idx+1][0] == 'B'

                if token_idx + 2 < len(tokens):
                    option_4 = tokens[token_idx] == ',' and tokens[token_idx+1] == 'and' and IOBtags[token_idx+2][0] == 'B'
                    option_5 = tokens[token_idx] == ',' and tokens[token_idx+1] == 'or'  and IOBtags[token_idx+2][0] == 'B'
                else:
                    option_4 = False
                    option_5 = False


                #Check if we should add to list or not
                if option_1:
                    self.tmp.append(ann_names[entity_number])
                    entity_number += 1
                    token_idx += 2  # Jump to right after B.
                elif option_2 or option_3:
                    self.tmp.append(ann_names[entity_number])
                    entity_number += 1
                    token_idx += 2  #Jump to right after B.
                    self._add_list_and_reset()  # Add tmp and reset
                elif option_4 or option_5:
                    self.tmp.append(ann_names[entity_number])
                    entity_number += 1
                    token_idx += 3  # Jump to right after B.       
                    # Add tmp and reset
                    self._add_list_and_reset()    
                else:
                    token_idx += 1
                    self._add_list_and_reset()

                # End if
            # End while loop
        # End loop over data_points

        return self.entity_lists

    def _add_list_and_reset(self):

        #Add key if does not exist
        if self.txt not in self.entity_lists:
            self.entity_lists[self.txt] = []

        #If length is minimum 3, add it
        if len(self.tmp) >= 3:
            self.entity_lists[self.txt].append(self.tmp)
        
        #Reset tmp
        self.tmp = []

        return

        